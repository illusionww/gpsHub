var layout;var map;var driver={};$(document).ready(function(){initMap();getDrivers();$(".driver-item").click(function(){var e=$(this).attr("id").substring(7);var c=map.getLayers().getArray()[1].getSource().getFeatures();var a;c.forEach(function(f){if(f.id==e){a=f.getGeometry().getExtent()}});if(a!=undefined){var b=map.getView();var d=ol.animation.pan({duration:400,source:(b.getCenter())});map.beforeRender(d);b.setCenter([a[0],a[1]])}})});function initMap(){map=new ol.Map({target:"map-canvas",layers:[new ol.layer.Tile({source:new ol.source.OSM()}),new ol.layer.Vector({source:new ol.source.Vector()})],view:new ol.View2D({center:ol.proj.transform([37.61778,55.75167],"EPSG:4326","EPSG:3857"),zoom:11}),controls:ol.control.defaults().extend([new ol.control.MousePosition({projection:"EPSG:4326"})])});map.on("postrender",function(){initLayout();map.updateSize()})}function initLayout(){layout=$("#container").layout({closeable:false,slidable:false,center__paneSelector:"#map-layout",west__paneSelector:"#list-layout",center__minWidth:300,west__size:250,west__minSize:200,spacing_open:1,spacing_closed:20,livePaneResizing:true,stateManagement__enabled:true,onresize:function(){map.updateSize()}});$("#list-layout").show()}function getDrivers(){$.ajax({url:"actions/drivers.php",type:"GET",dataType:"json",success:function(b){var a=Object.keys(b);a.forEach(function(d){if(driver[d]==undefined){var c=randomColor();$("#driver-"+d+" .circle").addClass("online");$("#driver-"+d+" .driver-color").css("background-color",c);driver[d]=addPoint(b[d].lat,b[d].lon,d,c)}else{movePoint(b[d].lat,b[d].lon,driver[d])}});getDrivers()}})}function addPoint(c,e,f,a){console.log(driver);var b=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([c,e],"EPSG:4326","EPSG:3857")),name:"Null Island",population:4000,rainfall:500});b.id=f;var d=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:0.75,src:"actions/taxiimage.php?color="+encodeURIComponent(a),size:[36,48]}))});b.setStyle(d);map.getLayers().getArray()[1].getSource().addFeature(b);return b}function movePoint(b,c,a){a.set("geometry",new ol.geom.Point(ol.proj.transform([b,c],"EPSG:4326","EPSG:3857")))}$(document).on("input",".clearable",function(){$(this)[tog(this.value)]("x")}).on("mousemove",".x",function(a){$(this)[tog(this.offsetWidth-18<a.clientX-this.getBoundingClientRect().left)]("onX")}).on("click",".onX",function(){$(this).removeClass("x onX").val("")});function tog(a){return a?"addClass":"removeClass"}function randomColor(){var a=Math.floor(Math.random()*16777215).toString(16);a="#"+("000000"+a).slice(-6);return a};