var layout;var map;var driver={};$(document).ready(function(){initMap();getDrivers();setInterval(getDrivers,1500)});function initMap(){map=new ol.Map({target:"map-canvas",layers:[new ol.layer.Tile({source:new ol.source.OSM()}),new ol.layer.Vector({source:new ol.source.Vector()})],view:new ol.View2D({center:ol.proj.transform([37.61778,55.75167],"EPSG:4326","EPSG:3857"),zoom:11})});map.on("postrender",function(){initLayout();map.updateSize()})}function initLayout(){layout=$("#container").layout({closeable:false,slidable:false,center__paneSelector:"#map-layout",west__paneSelector:"#list-layout",center__minWidth:300,west__size:250,west__minSize:200,spacing_open:1,spacing_closed:20,livePaneResizing:true,stateManagement__enabled:true,onresize:function(){map.updateSize()}});$("#list-layout").show()}function addPoint(c,a,e){console.log(driver);var b=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([c,a],"EPSG:4326","EPSG:3857")),name:"Null Island",population:4000,rainfall:500});var d=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",opacity:0.75,src:"img/marker.png"}))});b.setStyle(d);map.getLayers().getArray()[1].getSource().addFeature(b);return b}function movePoint(c,b,a){a.set("geometry",new ol.geom.Point(ol.proj.transform([c,b],"EPSG:4326","EPSG:3857")))}function getDrivers(){$.ajax({url:"actions/drivers.php",type:"GET",dataType:"json",success:function(b){var a=Object.keys(b);a.forEach(function(c){if(driver[c]==undefined){driver[c]=addPoint(b[c].lat,b[c].lng,c)}else{movePoint(b[c].lat,b[c].lng,driver[c])}})}})}$(document).on("input",".clearable",function(){$(this)[tog(this.value)]("x")}).on("mousemove",".x",function(a){$(this)[tog(this.offsetWidth-18<a.clientX-this.getBoundingClientRect().left)]("onX")}).on("click",".onX",function(){$(this).removeClass("x onX").val("")});function tog(a){return a?"addClass":"removeClass"};